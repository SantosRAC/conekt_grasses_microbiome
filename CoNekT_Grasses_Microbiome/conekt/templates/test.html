<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genome Bar Chart by Taxonomic Level</title>
    <script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
</head>
<body>
    <h1>Genome Bar Chart by Taxonomic Level</h1>
    <canvas id="genomeChart" width="600" height="400"></canvas>
    <script>
        async function fetchGenomeData() {
            console.log('Calling fetchGenomeData()...');
            try {
                const response = await fetch('/overview'); // Route changed to match backend
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                const data = await response.json();
                console.log('Data received', data);
                return data;
            } catch (error) {
                console.error('Error fetching and parsing JSON data', error);
                return {};
            }
        }

        async function createBarChart() {
            console.log('Creating bar chart...');
            const data = await fetchGenomeData();

            // Check if received data is empty or invalid
            if (Object.keys(data).length === 0) {
                console.error('JSON data is empty or invalid.');
                return;
            }

            console.log('Data received for chart:', data);

            // Defining correct order of labels
            const labels = ['domain', 'phylum', 'Class', 'order', 'family', 'genus', 'species'];

            // Creating array of values in the order of labels
            const values = labels.map(label => data[label] || 0);

            console.log('Labels:', labels);
            console.log('Values:', values);

            // Dataset settings for the bar chart
            const datasets = [{
                label: 'Number of Genomes by Taxonomic Level',
                data: values,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(201, 203, 207, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(201, 203, 207, 1)'
                ],
                borderWidth: 1
            }];

            // Chart.js configuration
            const ctx = document.getElementById('genomeChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true // Ensures y-axis starts from 0
                        }
                    }
                }
            });

            console.log('Chart created successfully!');
        }

        window.onload = createBarChart;
    </script>
</body>
</html>
